<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ROTA ‚Äî Chedworth Roman Villa</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --blue: #2d4a6b;
    --blue-dark: #1e3349;
    --blue-light: #3a5f8a;
    --red: #7a3f3f;
    --red-dark: #5c2e2e;
    --red-light: #9e5252;
    --cream: #f5f0e8;
    --white: #ffffff;
    --board-bg: #111111;
    --board-line: #e8e0cc;
    --p1-color: #c0392b;
    --p1-light: #e74c3c;
    --p2-color: #f5f0e8;
    --p2-border: #c8bfa8;
    --gold: #c9a84c;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Crimson Text', serif;
    background: var(--blue-dark);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
    position: relative;
  }

  /* Villa backdrop */
  .villa-backdrop {
    position: fixed;
    inset: 0;
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Chedworth_Roman_Villa_aerial_view.jpg/1280px-Chedworth_Roman_Villa_aerial_view.jpg');
    background-size: cover;
    background-position: center top;
    opacity: 0.18;
    z-index: 0;
    pointer-events: none;
  }

  /* Gradient overlay for depth */
  .backdrop-overlay {
    position: fixed;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(30, 51, 73, 0.6) 0%,
      rgba(30, 51, 73, 0.3) 30%,
      rgba(30, 51, 73, 0.3) 70%,
      rgba(30, 51, 73, 0.8) 100%
    );
    z-index: 0;
    pointer-events: none;
  }

  .game-container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 520px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 16px 32px;
  }

  /* ===== HEADER ===== */
  .header {
    width: 100%;
    text-align: center;
    padding: 20px 0 12px;
    border-bottom: 1px solid rgba(201, 168, 76, 0.3);
    margin-bottom: 14px;
  }

  .header-eyebrow {
    font-family: 'Cinzel', serif;
    font-size: 9px;
    letter-spacing: 4px;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 4px;
    opacity: 0.85;
  }

  .header h1 {
    font-family: 'Cinzel', serif;
    font-size: clamp(2rem, 8vw, 3rem);
    font-weight: 900;
    color: var(--white);
    letter-spacing: 8px;
    text-transform: uppercase;
    line-height: 1;
    text-shadow: 0 2px 20px rgba(0,0,0,0.5);
  }

  .header-sub {
    font-family: 'Cinzel', serif;
    font-size: 9px;
    letter-spacing: 3px;
    color: rgba(245, 240, 232, 0.6);
    margin-top: 6px;
  }

  /* ===== PHASE BANNER ===== */
  .phase-banner {
    width: 100%;
    padding: 10px 20px;
    border-radius: 4px;
    text-align: center;
    margin-bottom: 10px;
    transition: background 0.4s ease;
    border: 1px solid rgba(255,255,255,0.1);
  }

  .phase-banner.player1-turn {
    background: linear-gradient(135deg, var(--red-dark), var(--red));
  }

  .phase-banner.player2-turn {
    background: linear-gradient(135deg, var(--blue), var(--blue-light));
  }

  .phase-banner.game-over-banner {
    background: linear-gradient(135deg, #2a5a2a, #3d8b3d);
  }

  .turn-label {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: rgba(255,255,255,0.7);
    text-transform: uppercase;
    margin-bottom: 2px;
  }

  .turn-name {
    font-family: 'Cinzel', serif;
    font-size: clamp(1rem, 4vw, 1.3rem);
    font-weight: 700;
    color: var(--white);
    letter-spacing: 2px;
  }

  .phase-label {
    font-family: 'Crimson Text', serif;
    font-size: 13px;
    color: rgba(255,255,255,0.65);
    font-style: italic;
    margin-top: 2px;
  }

  /* ===== COUNTERS DISPLAY ===== */
  .counters-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 10px;
    padding: 0 4px;
  }

  .player-info {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
  }

  .player-info.p2 {
    flex-direction: row-reverse;
    text-align: right;
  }

  .counter-dots {
    display: flex;
    gap: 5px;
  }

  .counter-dot {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .counter-dot.p1 {
    background: var(--p1-color);
    border: 2px solid var(--p1-light);
    box-shadow: 0 0 6px rgba(192, 57, 43, 0.4);
  }

  .counter-dot.p1.used {
    background: transparent;
    border: 2px solid rgba(192, 57, 43, 0.25);
    box-shadow: none;
  }

  .counter-dot.p2 {
    background: var(--p2-color);
    border: 2px solid var(--p2-border);
    box-shadow: 0 0 6px rgba(245, 240, 232, 0.3);
  }

  .counter-dot.p2.used {
    background: transparent;
    border: 2px solid rgba(200, 191, 168, 0.25);
    box-shadow: none;
  }

  .player-label {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 1px;
    color: rgba(255,255,255,0.7);
  }

  .vs-divider {
    font-family: 'Cinzel', serif;
    font-size: 12px;
    color: var(--gold);
    letter-spacing: 2px;
    padding: 0 8px;
    opacity: 0.7;
  }

  /* ===== BOARD ===== */
  .board-wrapper {
    width: 100%;
    max-width: 380px;
    position: relative;
    margin: 4px 0;
  }

  .board-wrapper svg {
    width: 100%;
    height: auto;
    filter: drop-shadow(0 8px 32px rgba(0,0,0,0.6));
    border-radius: 8px;
  }

  /* Board node hit areas ‚Äî larger for touch */
  .node-hitarea {
    cursor: pointer;
    transition: opacity 0.15s;
  }

  .node-hitarea:active {
    opacity: 0.7;
  }

  /* ===== INSTRUCTION TEXT ===== */
  .instruction-text {
    font-family: 'Crimson Text', serif;
    font-size: 15px;
    color: rgba(245, 240, 232, 0.75);
    text-align: center;
    font-style: italic;
    margin: 8px 0;
    min-height: 22px;
    transition: opacity 0.3s;
  }

  /* ===== WIN OVERLAY ===== */
  .win-overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(10, 20, 35, 0.92);
    backdrop-filter: blur(4px);
    animation: fadeIn 0.4s ease;
  }

  .win-overlay.hidden { display: none; }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .win-card {
    background: linear-gradient(145deg, var(--blue-dark), var(--blue));
    border: 1px solid var(--gold);
    border-radius: 8px;
    padding: 40px 32px;
    text-align: center;
    max-width: 340px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 1px 0 rgba(201,168,76,0.2);
    animation: slideUp 0.4s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .win-laurel {
    font-size: 32px;
    margin-bottom: 8px;
    letter-spacing: 8px;
  }

  .win-title {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--gold);
    margin-bottom: 6px;
    text-transform: uppercase;
  }

  .win-player {
    font-family: 'Cinzel', serif;
    font-size: clamp(1.6rem, 6vw, 2.2rem);
    font-weight: 900;
    color: var(--white);
    letter-spacing: 3px;
    margin-bottom: 4px;
  }

  .win-subtitle {
    font-family: 'Crimson Text', serif;
    font-size: 17px;
    color: rgba(245,240,232,0.65);
    font-style: italic;
    margin-bottom: 28px;
  }

  .btn-play-again {
    font-family: 'Cinzel', serif;
    font-size: 13px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--blue-dark);
    background: var(--gold);
    border: none;
    padding: 14px 32px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 700;
    box-shadow: 0 4px 16px rgba(201, 168, 76, 0.3);
  }

  .btn-play-again:hover {
    background: #e0bc5a;
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(201, 168, 76, 0.4);
  }

  .btn-play-again:active {
    transform: translateY(0);
  }

  /* ===== HOW TO PLAY ===== */
  .how-to-play {
    width: 100%;
    margin-top: 16px;
    border: 1px solid rgba(201, 168, 76, 0.2);
    border-radius: 4px;
    overflow: hidden;
  }

  .htp-header {
    background: rgba(45, 74, 107, 0.6);
    padding: 10px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border: none;
    width: 100%;
    text-align: left;
  }

  .htp-header span {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--gold);
    text-transform: uppercase;
  }

  .htp-arrow {
    color: var(--gold);
    font-size: 12px;
    transition: transform 0.3s;
  }

  .htp-arrow.open { transform: rotate(180deg); }

  .htp-body {
    background: rgba(20, 35, 55, 0.6);
    padding: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s ease, padding 0.35s ease;
  }

  .htp-body.open {
    max-height: 400px;
    padding: 14px 16px;
  }

  .htp-body p {
    font-family: 'Crimson Text', serif;
    font-size: 15px;
    color: rgba(245, 240, 232, 0.8);
    line-height: 1.6;
    margin-bottom: 8px;
  }

  .htp-body p:last-child { margin-bottom: 0; }

  .htp-body strong {
    color: var(--gold);
    font-weight: 600;
  }

  /* ===== FOOTER ===== */
  .footer {
    margin-top: 20px;
    text-align: center;
    opacity: 0.4;
  }

  .footer p {
    font-family: 'Cinzel', serif;
    font-size: 8px;
    letter-spacing: 3px;
    color: var(--cream);
    text-transform: uppercase;
  }

  /* SVG board styles embedded */
  .board-line { stroke: #e8e0cc; stroke-width: 2.5; stroke-linecap: round; }
  .board-outer { fill: none; stroke: #e8e0cc; stroke-width: 2.5; }
  .node-bg { fill: #1a1a1a; }
  .node-empty { fill: #2a2a2a; stroke: #888; stroke-width: 1.5; }
  .node-p1 { fill: var(--p1-color); stroke: var(--p1-light); stroke-width: 2; }
  .node-p2 { fill: var(--p2-color); stroke: var(--p2-border); stroke-width: 2; }
  .node-selected { stroke: var(--gold) !important; stroke-width: 3 !important; }
  .node-valid-move { fill: rgba(201, 168, 76, 0.25); stroke: var(--gold); stroke-width: 2; stroke-dasharray: 3,2; }

</style>
</head>
<body>

<div class="villa-backdrop"></div>
<div class="backdrop-overlay"></div>

<div class="game-container">

  <!-- Header -->
  <header class="header">
    <div class="header-eyebrow">Ancient Roman Game</div>
    <h1>ROTA</h1>
    <div class="header-sub">Chedworth Roman Villa</div>
  </header>

  <!-- Phase Banner -->
  <div class="phase-banner player1-turn" id="phaseBanner">
    <div class="turn-label">Current Turn</div>
    <div class="turn-name" id="turnName">Player I</div>
    <div class="phase-label" id="phaseLabel">Place your counter</div>
  </div>

  <!-- Counters row -->
  <div class="counters-row">
    <div class="player-info p1" id="p1Info">
      <div class="counter-dots" id="p1Dots"></div>
      <div class="player-label">I</div>
    </div>
    <div class="vs-divider">VS</div>
    <div class="player-info p2" id="p2Info">
      <div class="player-label">II</div>
      <div class="counter-dots" id="p2Dots"></div>
    </div>
  </div>

  <!-- Board -->
  <div class="board-wrapper">
    <svg id="rotaBoard" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
      <!-- Black background -->
      <rect width="400" height="400" fill="#111111" rx="8"/>

      <!-- Decorative border -->
      <rect x="8" y="8" width="384" height="384" fill="none" stroke="#333" stroke-width="1" rx="6"/>
      <rect x="14" y="14" width="372" height="372" fill="none" stroke="#2a2a2a" stroke-width="1" rx="4"/>

      <!-- Outer circle -->
      <circle cx="200" cy="200" r="155" fill="none" stroke="#e8e0cc" stroke-width="2.5"/>

      <!-- Spokes from outer nodes to center -->
      <!-- Node positions: 8 outer nodes at 0,45,90,135,180,225,270,315 degrees, center -->
      <!-- Outer node positions (r=155):
           0:   (200, 45)   ‚Äî top
           1:   (310, 90)   ‚Äî top-right (approx)
           2:   (355, 200)  ‚Äî right
           3:   (310, 310)  ‚Äî bottom-right
           4:   (200, 355)  ‚Äî bottom
           5:   (90, 310)   ‚Äî bottom-left
           6:   (45, 200)   ‚Äî left
           7:   (90, 90)    ‚Äî top-left
      -->
      <!-- All spokes to center -->
      <line x1="200" y1="45" x2="200" y2="200" class="board-line"/>
      <line x1="310" y1="90" x2="200" y2="200" class="board-line"/>
      <line x1="355" y1="200" x2="200" y2="200" class="board-line"/>
      <line x1="310" y1="310" x2="200" y2="200" class="board-line"/>
      <line x1="200" y1="355" x2="200" y2="200" class="board-line"/>
      <line x1="90" y1="310" x2="200" y2="200" class="board-line"/>
      <line x1="45" y1="200" x2="200" y2="200" class="board-line"/>
      <line x1="90" y1="90" x2="200" y2="200" class="board-line"/>

      <!-- Node circles (drawn over lines) -->
      <!-- Center node (index 8) -->
      <circle id="node8" cx="200" cy="200" r="22" class="node-empty" data-index="8"/>

      <!-- Outer nodes -->
      <circle id="node0" cx="200" cy="45" r="22" class="node-empty" data-index="0"/>
      <circle id="node1" cx="310" cy="90" r="22" class="node-empty" data-index="1"/>
      <circle id="node2" cx="355" cy="200" r="22" class="node-empty" data-index="2"/>
      <circle id="node3" cx="310" cy="310" r="22" class="node-empty" data-index="3"/>
      <circle id="node4" cx="200" cy="355" r="22" class="node-empty" data-index="4"/>
      <circle id="node5" cx="90" cy="310" r="22" class="node-empty" data-index="5"/>
      <circle id="node6" cx="45" cy="200" r="22" class="node-empty" data-index="6"/>
      <circle id="node7" cx="90" cy="90" r="22" class="node-empty" data-index="7"/>

      <!-- Invisible large hit areas for touch -->
      <circle class="node-hitarea" cx="200" cy="45" r="36" fill="transparent" data-index="0" onclick="handleNodeClick(0)"/>
      <circle class="node-hitarea" cx="310" cy="90" r="36" fill="transparent" data-index="1" onclick="handleNodeClick(1)"/>
      <circle class="node-hitarea" cx="355" cy="200" r="36" fill="transparent" data-index="2" onclick="handleNodeClick(2)"/>
      <circle class="node-hitarea" cx="310" cy="310" r="36" fill="transparent" data-index="3" onclick="handleNodeClick(3)"/>
      <circle class="node-hitarea" cx="200" cy="355" r="36" fill="transparent" data-index="4" onclick="handleNodeClick(4)"/>
      <circle class="node-hitarea" cx="90" cy="310" r="36" fill="transparent" data-index="5" onclick="handleNodeClick(5)"/>
      <circle class="node-hitarea" cx="45" cy="200" r="36" fill="transparent" data-index="6" onclick="handleNodeClick(6)"/>
      <circle class="node-hitarea" cx="90" cy="90" r="36" fill="transparent" data-index="7" onclick="handleNodeClick(7)"/>
      <circle class="node-hitarea" cx="200" cy="200" r="36" fill="transparent" data-index="8" onclick="handleNodeClick(8)"/>
    </svg>
  </div>

  <!-- Instruction text -->
  <div class="instruction-text" id="instructionText">Place your counter on any empty spot</div>

  <!-- How to Play -->
  <div class="how-to-play">
    <button class="htp-header" onclick="toggleHowToPlay()">
      <span>How to Play</span>
      <span class="htp-arrow" id="htpArrow">‚ñº</span>
    </button>
    <div class="htp-body" id="htpBody">
      <p><strong>Aim:</strong> Be the first to get 3 of your counters in a row.</p>
      <p><strong>Phase 1 ‚Äî Placing:</strong> Take turns placing one counter at a time on any empty spot. Each player has 3 counters.</p>
      <p><strong>Phase 2 ‚Äî Moving:</strong> Once all 6 counters are placed, take turns sliding one counter along a line to an adjacent empty spot. No jumping allowed.</p>
      <p><strong>Winning:</strong> Three in a row means 3 consecutive spots around the outer ring, or 3 in a straight line through the centre. A spread-out triangle shape does <em>not</em> count.</p>
    </div>
  </div>

  <footer class="footer">
    <p>Rota &mdash; Ancient Roman Game &mdash; Chedworth Roman Villa</p>
  </footer>

</div>

<!-- Win Overlay -->
<div class="win-overlay hidden" id="winOverlay">
  <div class="win-card">
    <div class="win-laurel">üèõÔ∏è</div>
    <div class="win-title">Victoria!</div>
    <div class="win-player" id="winPlayerName">Player I</div>
    <div class="win-subtitle">wins the game of Rota</div>
    <button class="btn-play-again" onclick="resetGame()">Play Again</button>
  </div>
</div>

<script>
// =============================================
// ROTA GAME LOGIC
// =============================================

// Board: 9 nodes
// Indices 0-7: outer ring (clockwise from top)
// Index 8: centre

// Adjacency: each node connects to its neighbours
// Outer ring: consecutive (0-1-2-3-4-5-6-7-0)
// Centre (8): connects to ALL outer nodes

const ADJACENCY = {
  0: [1, 7, 8],
  1: [0, 2, 8],
  2: [1, 3, 8],
  3: [2, 4, 8],
  4: [3, 5, 8],
  5: [4, 6, 8],
  6: [5, 7, 8],
  7: [6, 0, 8],
  8: [0, 1, 2, 3, 4, 5, 6, 7]
};

// Winning lines: must be 3 connected nodes in a valid straight/curved line
// Valid wins:
// - 3 consecutive on outer ring (curved)
// - Any 3 through centre (straight spoke lines: outer-centre-outer)
const WIN_LINES = [
  // Consecutive outer ring triplets
  [0, 1, 2], [1, 2, 3], [2, 3, 4], [3, 4, 5],
  [4, 5, 6], [5, 6, 7], [6, 7, 0], [7, 0, 1],
  // Through centre (opposite pairs + centre)
  [0, 8, 4], [1, 8, 5], [2, 8, 6], [3, 8, 7],
  // Adjacent outer + centre (L-shape through centre counts as straight spoke)
  // Only opposite pairs through centre are valid straight lines
  // Adjacent spokes through centre would form a V, not a line ‚Äî excluded
];

// Game state
let board = new Array(9).fill(null); // null, 1, or 2
let currentPlayer = 1;
let phase = 'placing'; // 'placing' or 'moving'
let placedCount = [0, 0]; // pieces placed by each player
let selectedNode = null;
let gameOver = false;

function resetGame() {
  board = new Array(9).fill(null);
  currentPlayer = 1;
  phase = 'placing';
  placedCount = [0, 0];
  selectedNode = null;
  gameOver = false;
  document.getElementById('winOverlay').classList.add('hidden');
  renderBoard();
  updateUI();
}

function handleNodeClick(index) {
  if (gameOver) return;

  if (phase === 'placing') {
    handlePlacing(index);
  } else {
    handleMoving(index);
  }
}

function handlePlacing(index) {
  if (board[index] !== null) {
    setInstruction('That spot is taken ‚Äî choose an empty one');
    return;
  }

  board[index] = currentPlayer;
  placedCount[currentPlayer - 1]++;

  if (checkWin(currentPlayer)) {
    endGame(currentPlayer);
    return;
  }

  // Check if all pieces placed
  if (placedCount[0] === 3 && placedCount[1] === 3) {
    phase = 'moving';
  }

  switchPlayer();
  renderBoard();
  updateUI();
}

function handleMoving(index) {
  if (selectedNode === null) {
    // Select a piece
    if (board[index] !== currentPlayer) {
      if (board[index] !== null) {
        setInstruction("That's your opponent's counter ‚Äî select your own");
      } else {
        setInstruction('Select one of your counters first');
      }
      return;
    }
    selectedNode = index;
    renderBoard();
    setInstruction('Now tap an adjacent empty spot to move there');
  } else {
    // Try to move
    if (index === selectedNode) {
      // Deselect
      selectedNode = null;
      renderBoard();
      setInstruction('Select one of your counters to move');
      return;
    }

    if (board[index] !== null) {
      // Clicked another piece
      if (board[index] === currentPlayer) {
        // Switch selection to this piece
        selectedNode = index;
        renderBoard();
        setInstruction('Now tap an adjacent empty spot to move there');
      } else {
        setInstruction("You can't move onto your opponent's counter");
      }
      return;
    }

    // Check adjacency
    if (!ADJACENCY[selectedNode].includes(index)) {
      setInstruction("You can only move along a line to a neighbouring spot");
      return;
    }

    // Valid move
    board[index] = currentPlayer;
    board[selectedNode] = null;
    selectedNode = null;

    if (checkWin(currentPlayer)) {
      renderBoard();
      endGame(currentPlayer);
      return;
    }

    switchPlayer();
    renderBoard();
    updateUI();
  }
}

function switchPlayer() {
  currentPlayer = currentPlayer === 1 ? 2 : 1;
}

function checkWin(player) {
  return WIN_LINES.some(line =>
    line.every(idx => board[idx] === player)
  );
}

function endGame(winner) {
  gameOver = true;
  const name = winner === 1 ? 'Player I' : 'Player II';
  document.getElementById('winPlayerName').textContent = name;
  document.getElementById('winOverlay').classList.remove('hidden');

  // Update banner
  const banner = document.getElementById('phaseBanner');
  banner.className = 'phase-banner game-over-banner';
  document.getElementById('turnName').textContent = name + ' Wins!';
  document.getElementById('phaseLabel').textContent = 'Victoria!';
}

function updateUI() {
  const banner = document.getElementById('phaseBanner');
  const turnName = document.getElementById('turnName');
  const phaseLabel = document.getElementById('phaseLabel');

  banner.className = 'phase-banner ' + (currentPlayer === 1 ? 'player1-turn' : 'player2-turn');
  turnName.textContent = currentPlayer === 1 ? 'Player I' : 'Player II';

  if (phase === 'placing') {
    const remaining = 3 - placedCount[currentPlayer - 1];
    phaseLabel.textContent = `Place a counter ‚Äî ${remaining} left to place`;
    setInstruction('Place your counter on any empty spot');
  } else {
    phaseLabel.textContent = 'Move phase ‚Äî slide a counter';
    if (selectedNode === null) {
      setInstruction('Select one of your counters to move');
    }
  }

  updateCounterDots();
}

function setInstruction(text) {
  document.getElementById('instructionText').textContent = text;
}

function updateCounterDots() {
  const p1Dots = document.getElementById('p1Dots');
  const p2Dots = document.getElementById('p2Dots');
  p1Dots.innerHTML = '';
  p2Dots.innerHTML = '';

  for (let i = 0; i < 3; i++) {
    const d1 = document.createElement('div');
    d1.className = 'counter-dot p1' + (i >= placedCount[0] ? '' : '');
    // Show as used/on-board after placed
    if (phase === 'placing' && i >= placedCount[0]) {
      d1.classList.add('pending');
    }
    p1Dots.appendChild(d1);

    const d2 = document.createElement('div');
    d2.className = 'counter-dot p2';
    p2Dots.appendChild(d2);
  }
}

function renderBoard() {
  for (let i = 0; i < 9; i++) {
    const el = document.getElementById('node' + i);
    if (!el) continue;

    const isSelected = (selectedNode === i);
    const isValidMove = (phase === 'moving' && selectedNode !== null && board[i] === null && ADJACENCY[selectedNode].includes(i));

    if (board[i] === null) {
      if (isValidMove) {
        el.style.fill = 'rgba(201, 168, 76, 0.15)';
        el.style.stroke = '#c9a84c';
        el.style.strokeWidth = '2.5';
        el.style.strokeDasharray = '4,3';
      } else {
        el.style.fill = '#2a2a2a';
        el.style.stroke = '#666';
        el.style.strokeWidth = '1.5';
        el.style.strokeDasharray = '';
      }
    } else if (board[i] === 1) {
      el.style.fill = '#c0392b';
      el.style.stroke = isSelected ? '#c9a84c' : '#e74c3c';
      el.style.strokeWidth = isSelected ? '4' : '2';
      el.style.strokeDasharray = '';
    } else if (board[i] === 2) {
      el.style.fill = '#f5f0e8';
      el.style.stroke = isSelected ? '#c9a84c' : '#c8bfa8';
      el.style.strokeWidth = isSelected ? '4' : '2';
      el.style.strokeDasharray = '';
    }
  }
}

function toggleHowToPlay() {
  const body = document.getElementById('htpBody');
  const arrow = document.getElementById('htpArrow');
  body.classList.toggle('open');
  arrow.classList.toggle('open');
}

// Init
resetGame();
</script>
</body>
</html>
